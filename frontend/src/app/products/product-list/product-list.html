<nav class="navbar">
  <div class="navbar-container">
    <a routerLink="/" class="navbar-brand">
      <svg fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M10 2L3 7v11a1 1 0 001 1h3a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1h3a1 1 0 001-1V7l-7-5z" clip-rule="evenodd"></path>
      </svg>
      Ma Boutique
    </a>
    <div class="navbar-links">
      <ng-container *ngIf="(authService.currentUser | async) === null">
        <a routerLink="/auth/login" class="navbar-link login">Connexion</a>
        <a routerLink="/auth/register" class="navbar-link register">Inscription</a>
      </ng-container>
      <ng-container *ngIf="authService.currentUser | async as user">
        <span class="navbar-welcome">Bienvenue, {{ user.email }}</span>
        <a *ngIf="authService.isSeller()" routerLink="/products/new" class="navbar-button publish">
          <svg fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
          </svg>
          Publier un produit
        </a>
        <a *ngIf="authService.isAdmin()" routerLink="/admin" class="navbar-button admin">
          <svg fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zm-2 4a5 5 0 00-4.546 2.916A5.986 5.986 0 0010 16a5.986 5.986 0 004.546-2.084A5 5 0 0010 11z" clip-rule="evenodd"></path>
          </svg>
          Administration
        </a>
        <a *ngIf="authService.isSeller()" routerLink="/products/buy-vip-points" class="navbar-button vip">
          <svg fill="currentColor" viewBox="0 0 20 20">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.539 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.83-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.381-1.81.588-1.81h3.462a1 1 0 00.95-.69l1.07-3.292z"></path>
          </svg>
          Points VIP
        </a>
        <button (click)="logout()" class="navbar-button logout">
          <svg fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd"></path>
          </svg>
          Déconnexion
        </button>
      </ng-container>
    </div>
  </div>
</nav>

<div class="product-list-container">
  <h2 class="product-list-title">Tous les produits</h2>

  <div class="filters-card">
    <h3 class="filters-title">
      <svg fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M3 3a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h6a1 1 0 110 2H4a1 1 0 01-1-1zM3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
      </svg>
      Filtres et recherche
    </h3>
    <div class="filters-grid">
      <div class="filter-group">
        <label for="categoryFilter">Catégorie</label>
        <select
          id="categoryFilter"
          name="categoryFilter"
          [(ngModel)]="selectedCategoryId"
          (change)="filterByCategory()"
        >
          <option [ngValue]="null">Toutes les catégories</option>
          <option *ngFor="let category of categories" [ngValue]="category.id">{{ category.name }}</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="minPrice">Prix minimum</label>
        <input
          type="number"
          id="minPrice"
          name="minPrice"
          [(ngModel)]="minPrice"
          (input)="filterByCategory()"
          placeholder="0"
        />
      </div>
      <div class="filter-group">
        <label for="maxPrice">Prix maximum</label>
        <input
          type="number"
          id="maxPrice"
          name="maxPrice"
          [(ngModel)]="maxPrice"
          (input)="filterByCategory()"
          placeholder="∞"
        />
      </div>
      <div class="filter-group">
        <label for="sortBy">Trier par</label>
        <select
          id="sortBy"
          name="sortBy"
          [(ngModel)]="sortBy"
          (change)="filterByCategory()"
        >
          <option [ngValue]="null">Par défaut (VIP en premier)</option>
          <option value="price_asc">Prix croissant</option>
          <option value="price_desc">Prix décroissant</option>
          <option value="date_desc">Plus récent</option>
          <option value="date_asc">Plus ancien</option>
          <option value="popularity">Popularité</option>
        </select>
      </div>
    </div>
  </div>

  <div *ngIf="products.length === 0" class="no-products-message">
    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-5.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 003.586 13H4"></path>
    </svg>
    <h3>Aucun produit disponible</h3>
    <p>Il n'y a actuellement aucun produit correspondant à vos critères.</p>
  </div>

  <div *ngIf="products.length > 0" class="products-grid">
    <div *ngFor="let product of products" class="product-card" (click)="openProductDetailModal(product)">
      <!-- VIP Badge -->
      <div *ngIf="product.vipPoints && product.vipPoints.points > 0" class="product-card-vip-badge">
        <svg fill="currentColor" viewBox="0 0 20 20">
          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.539 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.83-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.381-1.81.588-1.81h3.462a1 1 0 00.95-.69l1.07-3.292z"></path>
        </svg>
        VIP
      </div>

      <img [src]="product.mainImage" alt="{{ product.title }}" class="product-card-image">

      <div class="product-card-content">
        <h3 class="product-card-title">{{ product.title }}</h3>
        <p class="product-card-description">{{ product.description }}</p>

        <div class="product-card-price-views">
          <p class="product-card-price">{{ product.price | currency:'XOF':'symbol':'1.0-0' }}</p>
          <div class="product-card-views">
            <svg fill="currentColor" viewBox="0 0 20 20">
              <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path>
              <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path>
            </svg>
            <span>{{ product.viewCount || 0 }}</span>
          </div>
        </div>

        <div class="product-card-actions">
          <span class="product-card-status"
                [ngClass]="{
                  'status-approved': product.status === 'APPROVED',
                  'status-pending': product.status === 'PENDING',
                  'status-rejected': product.status === 'REJECTED'
                }">
            {{ product.status === 'APPROVED' ? 'Approuvé' : product.status === 'PENDING' ? 'En attente' : product.status === 'REJECTED' ? 'Rejeté' : 'Désactivé' }}
          </span>

          <div class="product-card-buttons">
            <button class="product-card-button favorite" title="Ajouter aux favoris">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
              </svg>
            </button>
            <a *ngIf="product.whatsappLink" [href]="product.whatsappLink" target="_blank" class="product-card-button whatsapp" title="Contacter via WhatsApp">
              <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp" class="whatsapp-icon">
            </a>
            <div *ngIf="product.phoneNumber" class="product-card-button phone tooltip-container">
              <a [href]="'tel:' + product.phoneNumber" title="Appeler le vendeur">
                <svg fill="currentColor" viewBox="0 0 20 20">
                  <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.774a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"></path>
                </svg>
              </a>
              <span class="tooltip-text">{{ product.phoneNumber }}</span>
            </div>
            <button class="product-card-button chat" title="Discuter avec le vendeur">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Product Detail Modal -->
  <app-product-detail-modal
    *ngIf="selectedProduct"
    [product]="selectedProduct"
    (close)="closeProductDetailModal()"
  ></app-product-detail-modal>

  <!-- Pagination controls -->
  <div class="pagination-controls">
    <button
      (click)="onPageChange(currentPage - 1)"
      [disabled]="currentPage === 1"
      class="pagination-button prev"
    >
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
      Précédent
    </button>

    <div class="pagination-info">
      <span>
        Page {{ currentPage }}
      </span>
    </div>

    <button
      (click)="onPageChange(currentPage + 1)"
      [disabled]="products.length < pageSize"
      class="pagination-button next"
    >
      Suivant
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
    </button>
  </div>
</div>
