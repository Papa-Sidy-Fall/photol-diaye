<div class="product-form-container">
  <div class="product-form-card">
    <div class="product-form-header">
      <div class="product-form-icon-wrapper">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
          </svg>
      </div>
      <h2 class="product-form-title">
        Publier un nouveau produit
      </h2>
      <p class="product-form-subtitle">
        Utilisez votre caméra pour prendre des photos authentiques de votre produit
      </p>
    </div>
    <form class="product-form" [formGroup]="productForm" (ngSubmit)="onSubmit()">
      <div class="form-grid">
        <div class="form-group col-span-2">
          <label for="title">Titre du produit</label>
          <input
            id="title"
            name="title"
            type="text"
            formControlName="title"
            class="form-input"
            placeholder="Entrez le titre de votre produit"
          />
        </div>

        <div class="form-group col-span-2">
          <label for="description">Description</label>
          <textarea
            id="description"
            name="description"
            rows="4"
            formControlName="description"
            class="form-input textarea"
            placeholder="Décrivez votre produit en détail"
          ></textarea>
        </div>

        <div class="form-group">
          <label for="price">Prix (FCFA)</label>
          <input
            id="price"
            name="price"
            type="number"
            formControlName="price"
            class="form-input"
            placeholder="0"
          />
        </div>

        <div class="form-group">
          <label for="categoryId">Catégorie</label>
          <select
            id="categoryId"
            name="categoryId"
            formControlName="categoryId"
            class="form-input"
          >
            <option [ngValue]="null">Sélectionner une catégorie</option>
            <option *ngFor="let category of categories" [ngValue]="category.id">{{ category.name }}</option>
          </select>
        </div>

        <div class="form-group">
          <label for="whatsappLink">Lien WhatsApp</label>
          <input
            id="whatsappLink"
            name="whatsappLink"
            type="url"
            formControlName="whatsappLink"
            class="form-input"
            placeholder="https://wa.me/..."
          />
        </div>

        <div class="form-group">
          <label for="phoneNumber">Numéro de téléphone</label>
          <input
            id="phoneNumber"
            name="phoneNumber"
            type="tel"
            formControlName="phoneNumber"
            class="form-input"
            placeholder="+221 XX XXX XX XX"
          />
        </div>
      </div>
      <div class="image-capture-section">
        <div class="image-capture-header">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
          </svg>
          <label>Photos du produit (utilisez uniquement la caméra)</label>
        </div>

        <div class="image-capture-grid">
          <div class="camera-section">
            <div class="video-wrapper">
              <video #videoElement autoplay class="video-preview"></video>
              <div class="video-overlay">
                <span>Positionnez votre produit et capturez</span>
              </div>
            </div>
            <canvas #canvasElement class="canvas-hidden"></canvas>
            <button
              type="button"
              (click)="captureImage()"
              class="capture-button"
            >
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
              Capturer une photo
            </button>
          </div>

          <div class="captured-images-section">
            <h4 class="captured-images-title">Photos capturées ({{ capturedImages.length }})</h4>
            <div class="captured-images-grid">
              <div *ngFor="let image of capturedImages; let i = index" class="captured-image-wrapper">
                <img [src]="image" alt="Photo capturée" class="captured-image" />
                <div class="image-actions-overlay">
                  <div class="image-action-buttons">
                    <button
                      type="button"
                      (click)="setMainImage(image)"
                      [ngClass]="{'main-image-button': productForm.get('mainImage')?.value === image, 'secondary-image-button': productForm.get('mainImage')?.value !== image}"
                      title="Définir comme image principale"
                    >
                      <svg fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.539 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.83-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.381-1.81.588-1.81h3.462a1 1 0 00.95-.69l1.07-3.292z"></path>
                      </svg>
                    </button>
                    <button
                      type="button"
                      (click)="removeImage(i)"
                      class="remove-image-button"
                      title="Supprimer"
                    >
                      <svg fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                      </svg>
                    </button>
                  </div>
                </div>
                <div *ngIf="productForm.get('mainImage')?.value === image" class="main-image-indicator">
                  <svg fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                  </svg>
                </div>
              </div>
            </div>
            <div *ngIf="capturedImages.length === 0" class="no-photos-message">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
              <p>Aucune photo capturée</p>
            </div>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button
          type="button"
          routerLink="/products"
          class="cancel-button"
        >
          Annuler
        </button>
        <button
          type="submit"
          class="submit-button"
        >
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
          </svg>
          Publier le produit
        </button>
      </div>
    </form>
  </div>
</div>
